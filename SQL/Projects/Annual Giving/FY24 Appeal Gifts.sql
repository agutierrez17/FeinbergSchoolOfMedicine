CREATE OR REPLACE VIEW FSM_GP_AG_GIFTS AS

WITH CURRENT_FY AS
(SELECT CASE WHEN EXTRACT(MONTH FROM SYSDATE) >= 9
THEN EXTRACT(YEAR FROM SYSDATE)+1
ELSE EXTRACT(YEAR FROM SYSDATE)
END CFY
FROM DUAL
),

FY_START AS (
SELECT DISTINCT
FY,
"FY Start"
FROM DAY_NUMBERS
),

APP_SENDS AS (
SELECT
A.FSM_ID,
A.ID_NUMBER,
AP.APPEAL_CODE AS "Appeal Code",
AP.DESCRIPTION AS "Appeal Description",
A.APPEAL_CTGRY AS "Appeal Category",
'Mail' AS "Appeal Type",
(SELECT MIN(TO_DATE(G.DATE_OF_RECORD_KEY,'YYYYMMDD')) FROM DM_ARD.FACT_GIVING_TRANS@catrackstobi G WHERE G.APPEAL_SID = AP.APPEAL_SID) AS "Appeal Date",
A.FISCAL_YEAR AS "Fiscal Year",
AP.APPEAL_SID
FROM FSM_GP_APPEAL_DATA A
INNER JOIN DM_ARD.DIM_APPEAL@catrackstobi AP ON AP.APPEAL_CODE = A.N_APPEAL_CODE
),

EMAIL_SENDS AS (
---- PRE-FY24
SELECT DISTINCT
RECIPIENT_ID AS FSM_ID,
CONSTITUENT_ID AS ID_NUMBER,
CASE
WHEN MESSAGE_ID IN ('210163288','210177174','210203466') THEN 'KFEG1' --- FY20 Cancer Fall Appeals
  
WHEN MESSAGE_ID = '210178340' THEN 'KFEGE' --- FY20 Grateful Patient Fall Acq 1
WHEN MESSAGE_ID = '210203556' THEN 'KFEG4' --- FY20 Grateful Patient Fall Acq 2
WHEN MESSAGE_ID = '210177978' THEN 'KFEG7' --- FY20 Grateful Patient Fall Renew 1
WHEN MESSAGE_ID = '210203460' THEN 'KWEGB' --- FY20 Grateful Patient Fall Renew 2
  
WHEN MESSAGE_ID IN ('210490584','210504519','210520934','210531804') THEN 'LFEGB' -- FY21 Cancer Fall Appeals

WHEN MESSAGE_ID = '210818432' THEN 'LSEFL' -- FY21 GP Spring 1
WHEN MESSAGE_ID = '210823485' THEN 'LSEFM' -- FY21 GP Spring 2
WHEN MESSAGE_ID = '210829810' THEN 'LSEFN' -- FY21 GP Spring 3
  
WHEN MESSAGE_ID = '210959942' THEN 'MSEFL' -- FY22 GP Fall 1
WHEN MESSAGE_ID = '210993328' THEN 'MSEFM' -- FY22 GP Fall 2
WHEN MESSAGE_ID = '210970683' THEN 'MSEFN' -- FY22 GP Fall 3
WHEN MESSAGE_ID = '210980532' THEN 'MSEFO' -- FY22 GP Fall 4
  
WHEN MESSAGE_ID IN ('211316381','211344113') THEN 'NFBGD' -- FY23 GP Fall Emails
  
WHEN MESSAGE_ID = '211302973' THEN 'NUEG2' -- FY23 Lurie Renewal 1
WHEN MESSAGE_ID = '211316378' THEN 'NUEG3' -- FY23 Lurie Renewal 2
WHEN MESSAGE_ID = '211328286' THEN 'NUEG4' -- FY23 Lurie Renewal 3
WHEN MESSAGE_ID = '211343661' THEN 'NUEG5' -- FY23 Lurie Renewal 4
  
WHEN MESSAGE_ID = '211510745' THEN 'NSEFL' -- FY23 GP Spring 1
WHEN MESSAGE_ID = '211530833' THEN 'NSEFN' -- FY23 GP Spring 3
ELSE '' END AS "Appeal Code",
DESCRIPTION AS "Appeal Description",
CASE WHEN DESCRIPTION LIKE '%Grateful Patient%' THEN 'Grateful Patients' ELSE 'Cancer Team' END AS "Appeal Category",
'Email' AS "Appeal Type",
COALESCE((SELECT MIN(TO_DATE(G.DATE_OF_RECORD_KEY,'YYYYMMDD')) FROM DM_ARD.FACT_GIVING_TRANS@catrackstobi G WHERE G.APPEAL_SID = AP.APPEAL_SID),TO_DATE(AP.DATE_ADDED)) AS "Appeal Date",
CAST('20' || REPLACE(SUBSTR(DESCRIPTION,1,4),'FY','')AS INT) AS "Fiscal Year",
AP.APPEAL_SID
  
FROM ADVANCE_NU_RPT.ENCOMPASS_RECIPIENTS E
INNER JOIN DM_ARD.DIM_APPEAL@catrackstobi AP ON AP.APPEAL_CODE =
CASE
WHEN MESSAGE_ID IN ('210163288','210177174','210203466') THEN 'KFEG1' --- FY20 Cancer Fall Appeals
  
WHEN MESSAGE_ID = '210178340' THEN 'KFEGE' --- FY20 Grateful Patient Fall Acq 1
WHEN MESSAGE_ID = '210203556' THEN 'KFEG4' --- FY20 Grateful Patient Fall Acq 2
WHEN MESSAGE_ID = '210177978' THEN 'KFEG7' --- FY20 Grateful Patient Fall Renew 1
WHEN MESSAGE_ID = '210203460' THEN 'KWEGB' --- FY20 Grateful Patient Fall Renew 2
  
WHEN MESSAGE_ID IN ('210490584','210504519','210520934','210531804') THEN 'LFEGB' -- FY21 Cancer Fall Appeals

WHEN MESSAGE_ID = '210818432' THEN 'LSEFL' -- FY21 GP Spring 1
WHEN MESSAGE_ID = '210823485' THEN 'LSEFM' -- FY21 GP Spring 2
WHEN MESSAGE_ID = '210829810' THEN 'LSEFN' -- FY21 GP Spring 3

WHEN MESSAGE_ID = '210959942' THEN 'MSEFL' -- FY22 GP Fall 1
WHEN MESSAGE_ID = '210993328' THEN 'MSEFM' -- FY22 GP Fall 2
WHEN MESSAGE_ID = '210970683' THEN 'MSEFN' -- FY22 GP Fall 3
WHEN MESSAGE_ID = '210980532' THEN 'MSEFO' -- FY22 GP Fall 4
  
WHEN MESSAGE_ID IN ('211316381','211344113') THEN 'NFBGD' -- FY23 GP Fall Emails
  
WHEN MESSAGE_ID = '211302973' THEN 'NUEG2' -- FY23 Lurie Renewal 1
WHEN MESSAGE_ID = '211316378' THEN 'NUEG3' -- FY23 Lurie Renewal 2
WHEN MESSAGE_ID = '211328286' THEN 'NUEG4' -- FY23 Lurie Renewal 3
WHEN MESSAGE_ID = '211343661' THEN 'NUEG5' -- FY23 Lurie Renewal 4
  
WHEN MESSAGE_ID = '211510745' THEN 'NSEFL' -- FY23 GP Spring 1
WHEN MESSAGE_ID = '211530833' THEN 'NSEFN' -- FY23 GP Spring 3
ELSE '' END
  
WHERE
MESSAGE_ID IN (
'211316381',
'211344113',
'210178340',
'210203556',
'210177978',
'210203460',
'210163288',
'210177174',
'210203466',
'210818432',
'210823485',
'210829810',
'210959942',
'210993328',
'211302973',
'210970683',
'210980532',
'211316378',
'211316381',
'211328286',
'211343661',
'211344113',
'211510745',
'210490584',
'210504519',
'210520934',
'210531804',
'211530833'
)

UNION

---- FY24
SELECT DISTINCT
"id" AS FSM_ID,
substr('00000000000'|| "constituentId",-10) AS ID_NUMBER,
CASE
WHEN "messageID" IN ('211645273','211658885','211677236','211693662') THEN 'PFDGD' --'PFEGD' -- FY24 GP Fall Appeal 1
  
WHEN "messageID" = '211642550' THEN 'PFEGJ' -- FY24 Derm Appeal 1
WHEN "messageID" = '211658472' THEN 'PFEGK' -- FY24 Derm Appeal 2
  
WHEN "messageID" = '211649065' THEN 'PUEG2' -- FY24 LCC Fall Appeal 1
WHEN "messageID" = '211658007' THEN 'PUEG3' -- FY24 LCC Fall Appeal 2
WHEN "messageID" = '211674288' THEN 'PUEG4' -- FY24 LCC Fall Appeal 3
WHEN "messageID" = '211693734' THEN 'PUEG5' -- FY24 LCC Fall Appeal 4
  
WHEN "messageID" = '211658880' THEN 'PFEGL' -- CFAAR
  
ELSE '' END AS "Appeal Code",
CASE 
  WHEN "messageID" IN ('211645273') THEN 'FY24 FSM Grateful Patient Fall Appeal 1st Email Solicitation'
  WHEN "messageID" IN ('211658885') THEN 'FY24 FSM Grateful Patient Fall Appeal 2nd Email Solicitation'
  WHEN "messageID" IN ('211677236') THEN 'FY24 FSM Grateful Patient Fall Appeal 3rd Email Solicitation'
  WHEN "messageID" IN ('211693662') THEN 'FY24 FSM Grateful Patient Fall Appeal 4th Email Solicitation'
ELSE DESCRIPTION END AS "Appeal Description",
CASE WHEN APPEAL_CODE = 'PFEGL' THEN 'Medicine' WHEN DESCRIPTION LIKE '%Grateful Patient%' THEN 'Grateful Patients' ELSE 'Cancer Team' END AS "Appeal Category",
'Email' AS "Appeal Type",
COALESCE((SELECT MIN(TO_DATE(G.DATE_OF_RECORD_KEY,'YYYYMMDD')) FROM DM_ARD.FACT_GIVING_TRANS@catrackstobi G WHERE G.APPEAL_SID = AP.APPEAL_SID),TO_DATE(AP.DATE_ADDED)) AS "Appeal Date",
CAST('20' || REPLACE(SUBSTR(DESCRIPTION,1,4),'FY','')AS INT) AS "Fiscal Year",
AP.APPEAL_SID
  
FROM FSM_ENCOMPASS_RECIPIENTS E
INNER JOIN DM_ARD.DIM_APPEAL@catrackstobi AP ON AP.APPEAL_CODE =
CASE
WHEN "messageID" IN ('211645273','211658885','211677236','211693662') THEN 'PFDGD' --'PFDGD' -- FY24 GP Fall Appeal 1
  
WHEN "messageID" = '211642550' THEN 'PFEGJ' -- FY24 Derm Appeal 1
WHEN "messageID" = '211658472' THEN 'PFEGK' -- FY24 Derm Appeal 2
  
WHEN "messageID" = '211649065' THEN 'PUEG2' -- FY24 LCC Fall Appeal 1
WHEN "messageID" = '211658007' THEN 'PUEG3' -- FY24 LCC Fall Appeal 2
WHEN "messageID" = '211674288' THEN 'PUEG4' -- FY24 LCC Fall Appeal 3
WHEN "messageID" = '211693734' THEN 'PUEG5' -- FY24 LCC Fall Appeal 4

WHEN "messageID" = '211658880' THEN 'PFEGL' -- CFAAR
  
ELSE '' END
),


EMAIL_ALLOC_SENDS AS (
--- FY24 ALLOCATIONS (NO APPEAL CODE)
SELECT DISTINCT
"id" AS FSM_ID,
substr('00000000000'|| "constituentId",-10) AS ID_NUMBER,
CASE  
WHEN "messageID" = '211658779' THEN 'PFEGG' -- FY24 Rheum Email 1
WHEN "messageID" = '211658780' THEN 'PFEGH' -- FY24 Rheum Email 1
WHEN "messageID" IN ('211674337','211685139','211685140') THEN '3203006286901GFT' --- DGP Student Relief Emergency Fund
WHEN "messageID" IN ('211684256','211684259') THEN '3203000886101GFT' -- Opthalmology
ELSE '' END AS "Appeal Code",
  
CASE 
  WHEN "messageID" IN ('211658779') THEN 'FY24 FSM Rheumatology Appeal 1st Email Solicitation'
  WHEN "messageID" IN ('211658780') THEN 'FY24 FSM Rheumatology Appeal 2nd Email Solicitation'
  WHEN "messageID" IN ('211674337') THEN 'FY24 FSM DGP Fall Appeal 1st Email Solicitation'
  WHEN "messageID" IN ('211685139') THEN 'FY24 FSM DGP Fall Appeal 2nd Email Solicitation'
  WHEN "messageID" IN ('211685140') THEN 'FY24 FSM DGP Fall Appeal 3rd Email Solicitation'
  WHEN "messageID" IN ('211684256') THEN 'FY24 FSM Opthalmology Fall Appeal 1st Email Solicitation'
  WHEN "messageID" IN ('211684259') THEN 'FY24 FSM Opthalmology Fall Appeal 2nd Email Solicitation'
ELSE '' END AS "Appeal Description",
  
CASE WHEN "messageID" IN ('211684256','211684259') THEN 'Neuroscience' ELSE 'Cancer Team' END AS "Appeal Category",
  
'Email' AS "Appeal Type",
TO_DATE(CASE 
  WHEN "messageID" IN ('211658779','211658780') THEN '20231114'
  WHEN "messageID" IN ('211674337','211685139','211685140') THEN '20231114'
  WHEN "messageID" IN ('211684256') THEN '20231114'
  WHEN "messageID" IN ('211684259') THEN '20231220'
ELSE NULL END,'YYYYMMDD') AS "Appeal Date",
CAST('2024' AS INT) AS "Fiscal Year",
AL.ALLOCATION_SID AS APPEAL_SID
  
FROM FSM_ENCOMPASS_RECIPIENTS E
INNER JOIN DM_ARD.DIM_ALLOCATION@catrackstobi AL ON AL.ALLOCATION_CODE = 
CASE 
  WHEN "messageID" IN ('211674337','211685139','211685140') THEN '3203006286901GFT' -- GRATEFUL PATIENT
  WHEN "messageID" IN ('211684256','211684259') THEN '3203000886101GFT' -- OPTHALMOLOGY
  WHEN "messageID" IN ('211658779','211658780') THEN '3203002224201GFT' -- RHEUMATOLOGY
ELSE '' END
),

SENDS AS (
SELECT
*
FROM APP_SENDS
UNION
SELECT
*
FROM EMAIL_SENDS
),

SENDS_ALL AS (
SELECT
*
FROM SENDS
UNION
SELECT
*
FROM EMAIL_ALLOC_SENDS
),

GIFTS AS (
-----MAIL AND EMAIL APPEALS
SELECT DISTINCT
A."Appeal Code",
A."Appeal Description",
A."Appeal Category",
A.APPEAL_SID,
A."Appeal Date",
A."Appeal Type",
G.ENTITY_ID_NUMBER,
G.TRANS_ID_NUMBER,
G.DATE_OF_RECORD_KEY AS "Gift Date",
G.NEW_GIFTS_AND_CMIT_AMT AS "Gift Amount",
A."Fiscal Year"
FROM DM_ARD.FACT_GIVING_TRANS@catrackstobi G
--INNER JOIN CURRENT_FY ON G.YEAR_OF_GIVING = CURRENT_FY.CFY
INNER JOIN SENDS A ON A.APPEAL_SID = G.APPEAL_SID AND A."Appeal Type" = CASE WHEN A."Appeal Code" IN ('NFBGD','PFDGD') THEN 'Mail' ELSE A."Appeal Type" END

WHERE
G.NEW_GIFTS_AND_CMIT_AMT > 0

UNION

-----EMAIL ALLOC APPEALS
SELECT DISTINCT
A."Appeal Code",
A."Appeal Description",
A."Appeal Category",
A.APPEAL_SID,
A."Appeal Date",
A."Appeal Type",
G.ENTITY_ID_NUMBER,
G.TRANS_ID_NUMBER,
G.DATE_OF_RECORD_KEY AS "Gift Date",
G.NEW_GIFTS_AND_CMIT_AMT AS "Gift Amount",
A."Fiscal Year"
FROM DM_ARD.FACT_GIVING_TRANS@catrackstobi G
--INNER JOIN CURRENT_FY ON G.YEAR_OF_GIVING = CURRENT_FY.CFY
INNER JOIN EMAIL_ALLOC_SENDS A ON A.APPEAL_SID = G.ALLOCATION_SID AND TO_DATE(G.DATE_OF_RECORD_KEY,'YYYYMMDD') >= A."Appeal Date" AND A.ID_NUMBER = G.ENTITY_ID_NUMBER

WHERE
G.NEW_GIFTS_AND_CMIT_AMT > 0
--AND
--A."Appeal Description" NOT IN ('FY24 FSM Rheumatology Appeal 2nd Email Solicitation','FY24 FSM DGP Fall Appeal 2nd Email Solicitation','FY24 FSM DGP Fall Appeal 3rd Email Solicitation')
),

NOAPL AS (
----MAIL APPEALS
SELECT DISTINCT
A."Appeal Code",
A."Appeal Description",
A."Appeal Category",
AP.APPEAL_SID,
A."Appeal Date",
A."Appeal Type",
G.ENTITY_ID_NUMBER,
G.TRANS_ID_NUMBER,
G.DATE_OF_RECORD_KEY AS "Gift Date",
CASE WHEN G2.ENTITY_ID_NUMBER IS NOT NULL THEN G2.NEW_GIFTS_AND_CMIT_AMT ELSE G.NEW_GIFTS_AND_CMIT_AMT END AS "Gift Amount",
A."Fiscal Year"
FROM DM_ARD.FACT_GIVING_TRANS@catrackstobi G
INNER JOIN APP_SENDS A ON A.ID_NUMBER = G.ENTITY_ID_NUMBER AND G.YEAR_OF_GIVING = A."Fiscal Year" AND A."Appeal Category" NOT IN ('Grateful Patients')
INNER JOIN DM_ARD.DIM_APPEAL@catrackstobi AP ON AP.APPEAL_SID = G.APPEAL_SID
INNER JOIN DM_ARD.DIM_ALLOCATION@catrackstobi AL ON G.ALLOCATION_SID = AL.ALLOCATION_SID AND AL.CURRENT_INDICATOR = 'Y'
LEFT OUTER JOIN DM_ARD.FACT_GIVING_TRANS@catrackstobi G2 ON G.TRANS_ID_NUMBER = G2.TRANS_ID_NUMBER AND G2.GIFT_ASSOCIATED_SID = '3' AND G.GIFT_ASSOCIATED_SID <> '3'

WHERE
AP.APPEAL_CODE = 'NOAPL'
AND
AL.ALLOCATION_CODE IN (
'3203000890801GFT',
'3203000905701GFT',
'3203000908201GFT',
'3203000916501GFT',
'3203000934001GFT',
'3203000951901GFT',
'3203002191001GFT',
'3203002581901GFT',
'3203002619701GFT',
'3203002637401GFT',
'3203002761501GFT',
'3203002763601GFT',
'3203002852301GFT',
'3203002879401GFT',
'3203002921701GFT',
'3203003023001GFT',
'3203003034901GFT',
'3203003035001GFT',
'3203003059401GFT',
'3203003060401GFT',
'3203003076701GFT',
'3203003116301GFT',
'3203003122401GFT',
'3203003155201GFT',
'3203003159101GFT',
'3203003317301GFT',
'3203003536101GFT',
'3203003625101GFT',
'3203003750101GFT',
'3203003914701GFT',
'3203003952701GFT',
'3203004172501GFT',
'3203004272601GFT',
'3203004686701GFT',
'3203005213501GFT',
'3203002116501GFT'
)
AND
CASE WHEN G2.ENTITY_ID_NUMBER IS NOT NULL THEN G2.NEW_GIFTS_AND_CMIT_AMT ELSE G.NEW_GIFTS_AND_CMIT_AMT END > 0
),

FTD AS (
SELECT DISTINCT
G.ENTITY_ID_NUMBER
FROM GIFTS G
LEFT OUTER JOIN DM_ARD.FACT_GIVING_TRANS@catrackstobi G2 ON G.ENTITY_ID_NUMBER = G2.ENTITY_ID_NUMBER
     AND G2.NEW_GIFTS_AND_CMIT_AMT > 0 AND G2.REPORTING_AREA_SID = '21' AND TO_DATE(G2.DATE_OF_RECORD_KEY,'YYYYMMDD') < TO_DATE(G."Gift Date",'YYYYMMDD')

WHERE
G2.ENTITY_ID_NUMBER IS NULL
),

RD AS (
SELECT DISTINCT
G.ENTITY_ID_NUMBER
FROM GIFTS G
LEFT OUTER JOIN DM_ARD.FACT_GIVING_TRANS@catrackstobi G2 ON G.ENTITY_ID_NUMBER = G2.ENTITY_ID_NUMBER
     AND G2.NEW_GIFTS_AND_CMIT_AMT > 0 AND G2.REPORTING_AREA_SID = '21'
     AND TO_DATE(G2.DATE_OF_RECORD_KEY,'YYYYMMDD') < TO_DATE(G."Gift Date",'YYYYMMDD')
     AND MONTHS_BETWEEN(TO_DATE(G."Gift Date",'YYYYMMDD'),TO_DATE(G2.DATE_OF_RECORD_KEY,'YYYYMMDD')) <= 60
LEFT OUTER JOIN DM_ARD.FACT_GIVING_TRANS@catrackstobi G3 ON G.ENTITY_ID_NUMBER = G3.ENTITY_ID_NUMBER
     AND G3.NEW_GIFTS_AND_CMIT_AMT > 0 AND G3.REPORTING_AREA_SID = '21'
     AND TO_DATE(G3.DATE_OF_RECORD_KEY,'YYYYMMDD') < TO_DATE(G."Gift Date",'YYYYMMDD')
     AND MONTHS_BETWEEN(TO_DATE(G."Gift Date",'YYYYMMDD'),TO_DATE(G3.DATE_OF_RECORD_KEY,'YYYYMMDD')) > 60
     AND G2.ENTITY_ID_NUMBER IS NULL
WHERE
G3.ENTITY_ID_NUMBER IS NOT NULL
)


------APPEAL GIFTS
SELECT
G.ENTITY_ID_NUMBER,
G."Appeal Code",
G."Appeal Description",
G."Appeal Category",
G.APPEAL_SID,
CASE WHEN G."Appeal Date" < FY_START."FY Start" THEN FY_START."FY Start" ELSE G."Appeal Date" END AS "Appeal Date",
G."Appeal Type",
G.TRANS_ID_NUMBER,
G."Gift Date",
G."Gift Amount",
G."Fiscal Year",
CASE WHEN FTD.ENTITY_ID_NUMBER IS NOT NULL THEN 1 ELSE 0 END AS "First Time Donor",
CASE WHEN RD.ENTITY_ID_NUMBER IS NOT NULL THEN 1 ELSE 0 END AS "Reactivated Donor"
FROM GIFTS G
INNER JOIN FY_START ON G."Fiscal Year" = FY_START.FY
LEFT OUTER JOIN FTD ON G.ENTITY_ID_NUMBER = FTD.ENTITY_ID_NUMBER
LEFT OUTER JOIN RD ON G.ENTITY_ID_NUMBER = RD.ENTITY_ID_NUMBER

UNION

------ APPEAL SENDS
SELECT
CASE WHEN A.ID_NUMBER IS NOT NULL AND A.ID_NUMBER <> '0000000000' THEN A.ID_NUMBER ELSE A.FSM_ID END AS "ENTITY_ID_NUMBER",
A."Appeal Code",
A."Appeal Description",
A."Appeal Category",
A.APPEAL_SID,
CASE WHEN A."Appeal Date" < FY_START."FY Start" THEN FY_START."FY Start" ELSE A."Appeal Date" END AS "Appeal Date",
A."Appeal Type",
NULL AS "TRANS_ID_NUMBER",
NULL AS "Gift Date",
NULL AS "Gift Amount",
A."Fiscal Year",
0 AS "First Time Donor",
0 AS "Reactivated Donor"
FROM SENDS_ALL A 
INNER JOIN FY_START ON A."Fiscal Year" = FY_START.FY

UNION

------ NO APPEAL GIFTS
SELECT
N.ENTITY_ID_NUMBER,
N."Appeal Code",
N."Appeal Description",
N."Appeal Category",
N.APPEAL_SID,
CASE WHEN N."Appeal Date" < FY_START."FY Start" THEN FY_START."FY Start" ELSE N."Appeal Date" END AS "Appeal Date",
N."Appeal Type",
N.TRANS_ID_NUMBER,
N."Gift Date",
N."Gift Amount",
N."Fiscal Year",
0 AS "First Time Donor",
0 AS "Reactivated Donor"
FROM NOAPL N
INNER JOIN FY_START ON N."Fiscal Year" = FY_START.FY

--ORDER BY
--G.ENTITY_ID_NUMBER
;
